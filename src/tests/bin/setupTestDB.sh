#!/bin/sh
set -e

initial_dir=`pwd`
propel_dir=../../../propel
test_propel_config_dir_from_propel_dir=../src/tests/config/
propel_bin_from_propel_dir=../vendor/bin/propel

cd $propel_dir
# Generate connection file (linking to the TestDB)
$propel_bin_from_propel_dir config:convert --config-dir=$test_propel_config_dir_from_propel_dir -vvv
# Rebuild Classes, not really necessary but nice to make sure its all working as intended and prevent conflicts with older autogenerated files
$propel_bin_from_propel_dir sql:build -v --overwrite --config-dir=$test_propel_config_dir_from_propel_dir
$propel_bin_from_propel_dir model:build -v
# Seeds DB
$propel_bin_from_propel_dir sql:insert -v --config-dir=$test_propel_config_dir_from_propel_dir
